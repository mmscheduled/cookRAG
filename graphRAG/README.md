# GraphRAG - 基于图结构的食谱知识图谱系统

## 概述

GraphRAG是一个基于图结构的食谱知识图谱系统，能够更好地表达食材、菜品、烹饪方法之间的复杂关系。相比传统的RAG系统，GraphRAG具有以下优势：

- **复杂关系查询**: 支持"和鸡肉搭配的食材有哪些"等复杂查询
- **潜在关联发现**: 能够发现食材之间的潜在关联
- **智能推荐算法**: 基于图的推荐算法，提供更精准的推荐
- **多维度分析**: 从食材、烹饪方法、分类等多个维度进行分析
- **LLM集成**: 集成KimiLLM，提供智能回答生成和查询理解增强

## 系统架构

```text
graphRAG/
├── main.py                    # 主程序入口
├── graph_models.py           # 图数据模型
├── graph_builder.py          # 图构建器
├── graph_storage.py          # 图存储和查询
├── complex_queries.py        # 复杂查询处理器
├── recommendation_engine.py  # 推荐引擎
├── llm_integration.py        # LLM集成模块
├── config.py                 # 配置文件
├── config_example.py         # 配置示例
├── demo.py                   # 演示脚本
├── test_llm_integration.py   # LLM集成测试
├── requirements.txt          # 依赖包
└── README.md                 # 说明文档
```

## 核心功能

### 1. 图结构数据模型

- **节点类型**: 菜品、食材、烹饪方法、分类、工具、调料
- **边类型**: 包含关系、使用方法、属于分类、搭配关系、相似关系等
- **属性支持**: 每个节点和边都可以包含丰富的属性信息

### 2. 智能图构建

- 自动从食谱数据中提取实体和关系
- 构建食材搭配关系网络
- 计算菜品相似度
- 建立多维度关联

### 3. 复杂关系查询

支持多种自然语言查询类型：

- **搭配查询**: "和鸡肉搭配的食材有哪些"
- **推荐查询**: "推荐一些用西红柿做的菜"
- **相似查询**: "和西红柿炒鸡蛋相似的菜"
- **替代查询**: "鸡蛋的替代品有哪些"
- **方法查询**: "炒的常用食材有哪些"

### 4. 智能推荐系统

- **基于食材的菜品推荐**: 根据可用食材推荐合适的菜品
- **基于菜品的食材推荐**: 为指定菜品推荐搭配食材
- **相似菜品推荐**: 基于图结构发现相似菜品
- **混合推荐**: 综合多种因素的智能推荐

### 5. 深度分析功能

- **食材网络分析**: 分析食材的搭配模式和使用频率
- **热门组合发现**: 发现流行的食材组合
- **兼容性分析**: 分析食材之间的兼容性
- **路径发现**: 发现食材之间的关联路径

## 安装和使用

### 1. 安装依赖

```bash
cd graphRAG
pip install -r requirements.txt
```

### 2. 运行演示

```bash
python demo.py
```

### 3. 交互式查询

```bash
python main.py
```

### 4. LLM集成配置

#### 环境变量设置

```bash
# 设置KimiLLM API密钥
export MOONSHOT_API_KEY="your_api_key_here"
```

#### 配置LLM功能

```python
from config import GraphRAGConfig

# 启用LLM功能
config = GraphRAGConfig(
    enable_llm=True,
    llm_model="kimi-k2-0711-preview",
    llm_temperature=0.1,
    llm_max_tokens=2048
)

# 禁用LLM功能
config = GraphRAGConfig(enable_llm=False)
```

### 5. 编程接口使用

```python
from graphRAG import GraphRAGSystem
from config import GraphRAGConfig

# 创建配置
config = GraphRAGConfig(enable_llm=True)

# 初始化系统
graph_rag = GraphRAGSystem(config)
graph_rag.initialize_system()

# 处理查询（使用LLM增强）
result = graph_rag.process_query("和鸡肉搭配的食材有哪些", use_llm=True)

# 处理查询（不使用LLM）
result = graph_rag.process_query("和鸡肉搭配的食材有哪些", use_llm=False)

# 推荐菜品
recommendations = graph_rag.recommend_dishes(["西红柿", "鸡蛋"])

# 推荐搭配食材
ingredients = graph_rag.recommend_ingredients("西红柿炒鸡蛋")
```

## 查询示例

### 1. 食材搭配查询

```text
用户: "和鸡肉搭配的食材有哪些"
系统: 找到 15 个搭配食材:
  1. 香菇 (共同出现 8 次)
  2. 土豆 (共同出现 6 次)
  3. 青椒 (共同出现 5 次)
  ...
```

### 2. 菜品推荐

```text
用户: "推荐一些用西红柿做的菜"
系统: 推荐 10 个菜品:
  1. 西红柿炒鸡蛋 (完成度: 100%)
  2. 西红柿鸡蛋汤 (完成度: 100%)
  3. 西红柿牛腩 (完成度: 50%)
  ...
```

### 3. 相似菜品推荐

```text
用户: "和西红柿炒鸡蛋相似的菜"
系统: 找到 5 个相似菜品:
  1. 西红柿鸡蛋汤 (相似度: 0.75)
  2. 洋葱炒鸡蛋 (相似度: 0.60)
  3. 韭菜炒鸡蛋 (相似度: 0.55)
  ...
```

### 4. 食材分析

```text
用户: "分析一下鸡蛋"
系统: 
  总菜品数: 25
  常见搭配: 12 个
  烹饪方法: 8 种
  分类: 蛋类
  热门搭配:
    1. 西红柿 (共同出现 15 次)
    2. 葱 (共同出现 10 次)
    3. 韭菜 (共同出现 8 次)
    ...
```

## 技术特点

### 1. 图结构优势

- **关系表达**: 能够表达复杂的多对多关系
- **路径查询**: 支持多跳关系查询
- **社区发现**: 能够发现食材和菜品的社区结构
- **中心性分析**: 识别重要的食材和菜品

### 2. 智能算法

- **协同过滤**: 基于用户行为的推荐
- **内容推荐**: 基于内容相似性的推荐
- **混合推荐**: 结合多种推荐策略
- **实时计算**: 支持实时查询和推荐

### 3. LLM集成功能

- **智能回答生成**: 基于图结构信息生成自然语言回答
- **查询理解增强**: 自动理解用户查询意图和实体
- **上下文感知**: 利用图关系提供更准确的回答
- **流式生成**: 支持流式回答生成，提升用户体验
- **多模式支持**: 支持有LLM和无LLM两种模式

### 4. 扩展性

- **模块化设计**: 各组件独立，易于扩展
- **插件架构**: 支持自定义查询和推荐算法
- **多数据源**: 支持多种数据格式和来源
- **分布式**: 支持大规模图数据的分布式处理

## 性能优化

### 1. 索引优化

- **名称索引**: 快速名称搜索
- **类型索引**: 按类型快速过滤
- **反向索引**: 支持反向关系查询

### 2. 缓存策略

- **查询缓存**: 缓存常用查询结果
- **推荐缓存**: 缓存推荐结果
- **图缓存**: 缓存图结构数据

### 3. 算法优化

- **并行计算**: 支持并行图计算
- **增量更新**: 支持图的增量更新
- **近似算法**: 使用近似算法提高性能

## 未来规划

### 1. 功能扩展

- **用户画像**: 基于用户偏好的个性化推荐
- **营养分析**: 集成营养成分分析
- **季节推荐**: 基于季节的智能推荐
- **地域特色**: 支持不同地域的菜系特色

### 2. 技术升级

- **深度学习**: 集成深度学习模型
- **知识图谱**: 与外部知识图谱集成
- **多模态**: 支持图像和文本的多模态分析
- **实时更新**: 支持实时数据更新

### 3. 应用场景

- **智能厨房**: 智能厨房助手
- **营养管理**: 个人营养管理
- **餐饮推荐**: 餐厅菜品推荐
- **教学辅助**: 烹饪教学辅助

## 贡献指南

欢迎贡献代码和建议！请遵循以下步骤：

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。

## 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 Issue
- 发送邮件
- 参与讨论

---

**GraphRAG** - 让食谱知识图谱更智能！
